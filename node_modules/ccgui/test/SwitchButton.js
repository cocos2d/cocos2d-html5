/**
 * Created by Huabin LING on 1/2/14.
 */

var SwitchButton = GuiTest.extend({
    ctor:function () {
        this._super();

        var winSize = cc.Director.getInstance().getWinSize();

        // Parent layer
        var layer = cc.Node.create();
        layer.setPosition(winSize.width / 2, winSize.height / 2);
        this.addChild(layer, 1);

        var layer_width = 0;

        // Add the black background for the text
        var background = cc.Scale9Sprite.create(res.buttonBackground_png);
        background.setContentSize(80, 50);
        background.setPosition(layer_width + background.getContentSize().width / 2.0, 0);
        layer.addChild(background);

        layer_width += background.getContentSize().width;

        this._displayValueLabel = cc.LabelTTF.create("#color", "Arial-BoldMT", 30);
        this._displayValueLabel.retain();
        this._displayValueLabel.setPosition(background.getPosition());
        layer.addChild(this._displayValueLabel);

        // Create the switch
        var switchControl = cc.ControlSwitch.create
            (
                cc.Sprite.create(res.switch_mask_png),
                cc.Sprite.create(res.switch_on_png),
                cc.Sprite.create(res.switch_off_png),
                cc.Sprite.create(res.switch_thumb_png),
                cc.LabelTTF.create("On", "Arial-BoldMT", 16),
                cc.LabelTTF.create("Off", "Arial-BoldMT", 16)
            );
        switchControl.setPosition(layer_width + 10 + switchControl.getContentSize().width / 2, 0);
        layer.addChild(switchControl);

        switchControl.addTargetWithActionForControlEvents(this, this.valueChanged, cc.CONTROL_EVENT_VALUECHANGED);

        // Set the layer size
        layer.setContentSize(layer_width, 0);
        layer.setAnchorPoint(0.5, 0.5);

        // Update the value label
        this.valueChanged(switchControl, cc.CONTROL_EVENT_VALUECHANGED);
    },

    valueChanged:function (sender, controlEvent) {
        if (sender.isOn()) {
            this._displayValueLabel.setString("On");
        }
        else {
            this._displayValueLabel.setString("Off");
        }
    }
});

SwitchButton.create = function () {
    return new SwitchButton();
};